function CreateMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:4,center:{lat:-13.1238,lng:-50.8998864},maxZoom:20,minZoom:2,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!1})}function InitMap(o){vetorDeMarkers.length>0&&removerMarcadores(vetorDeMarkers);var e=JSON.parse(o);gerarTabela(e),infoWindow=new google.maps.InfoWindow,e.length>0&&displayMarkers(e)}function removeLines(){flightPath.setMap(null)}function PolyMap(o){for(var e=0;e<o.length;e++){var a=!0;if(void 0!==o[e].lng&&void 0!==o[e].lat)for(var i=e+1;i<o.length;i++)if(o[e].dispositivo.nome==o[i].dispositivo.nome&&a){var t=[{lat:o[e].lat,lng:o[e].lng},{lat:o[i].lat,lng:o[i].lng}];a=!1,(flightPath=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:cores[Math.floor(o[e].dispositivo.nome[o[e].dispositivo.nome.length-1])]})).setMap(map)}}}function createMarker(o,e,a,i){var t=new google.maps.Marker({icon:null,label:{color:"#000000",text:e.toString(),fontSize:"8px",fontWeight:"900"},map:map,position:o});switch(i.mensagem){case"SIGA-ME":t.icon={url:iconSigaMe,labelOrigin:new google.maps.Point(32.5,6.5)};break;case"ESTOU-AQUI":t.icon={url:iconOk,labelOrigin:new google.maps.Point(31.5,6.5)};break;case"PERSONALIZADA":t.icon={url:iconPersonalizada,labelOrigin:new google.maps.Point(24.5,6)};break;case"SOS":t.icon={url:iconSOS,labelOrigin:new google.maps.Point(31.5,6.5)},t.setAnimation(google.maps.Animation.BOUNCE),!0!==i.visto&&a?($("#mostrar_notificacao").show(),somAlarme.play(),NotificacaoSOS()):(t.setAnimation(null),somAlarme.pause());break;case"QUEDA":case"AJUDA":t.icon={url:iconAlarme,labelOrigin:new google.maps.Point(36.5,5.5)},t.setAnimation(google.maps.Animation.BOUNCE),!0!==i.visto&&a?($("#mostrar_notificacao").show(),somAlarme.play(),NotificacaoAjuda(i.dispositivo.nome)):t.setAnimation(null)}google.maps.event.addListener(t,"click",function(){var e;e=void 0!==i.userDispositivo[0]?'<div id="iw_container"><div class="iw_title"> <strong> Usuário:</strong> '+i.userDispositivo[0].nome+"  &nbsp"+i.userDispositivo[0].sobrenome+' &nbsp <a href="#"  title="Editar Usuario",  id="esconderNoInicio" , data-toggle="modal" data-target="#modalUsuario"  onclick=selPersona(\''+JSON.stringify(i.userDispositivo[0],substitui)+'\'); > <img class="icone-modal-map" src="images/visualizar.svg"/> </a></div><div class="iw_content"> <strong> Dispositivo:</strong> '+i.dispositivo.nome+"</br> <strong> Mensagem:</strong> "+i.mensagem+"</br><strong> Localização:</strong> "+o+"</br> <strong> Data:</strong> "+i.data+"</br> <strong> Hora:</strong> "+i.hora+"</div>":i.user?void 0===i.user[0]?'<div id="iw_container"><div class="iw_title"><strong> Usuário:</strong> Sem Usuário </div><div class="iw_content"><strong> Dispositivo: </strong>'+i.dispositivo.nome+"</br><strong> Mensagem:</strong> "+i.mensagem+"</br><strong>Localização:</strong> "+o+"</br><strong>Data:</strong> "+i.data+"</br><strong>Hora:</strong> "+i.hora+"</div>":'<div id="iw_container"><div class="iw_title"> <strong> Usuário:</strong> '+i.user[0].nome+"  &nbsp"+i.user[0].sobrenome+' &nbsp <a href="#"  title="Editar Usuario", name="esconderNoInicio" type="button", id="esconderNoInicio" , data-toggle="modal" data-target="#modalUsuario"  onclick=selPersona(\''+JSON.stringify(i.user[0],substitui)+'\');> <img class="icone-modal-map" src="images/visualizar.svg"/> </a></div><div class="iw_content"><strong> Dispositivo:</strong> '+i.dispositivo.nome+"</br><strong> Mensagem:</strong> "+i.mensagem+"</br><strong>Localização:</strong> "+o+"</br><strong>Data:</strong>"+i.data+"</br><strong>Hora:</strong> "+i.hora+"</div>":'<div id="iw_container"><div class="iw_title"><strong> Usuário:</strong> Sem Usuário </div><div class="iw_content"><strong> Dispositivo: </strong>'+i.dispositivo.nome+"</br><strong> Mensagem:</strong> "+i.mensagem+"</br><strong>Localização:</strong> "+o+"</br><strong>Data:</strong> "+i.data+"</br><strong>Hora:</strong> "+i.hora+"</div>",infoWindow.setContent(e),infoWindow.open(map,t),t.setAnimation(null),somAlarme.pause(),getInformacaoQualquer(i.dispositivo.nome)}),vetorDeMarkers.push(t)}function displayMarkers(o){for(var e,a=new google.maps.LatLngBounds,i=[],t=0;t<o.length;t++){i[t]=1,void 0!==o[t].lng&&void 0!==o[t].lat&&(e=new google.maps.LatLng(o[t].lat,o[t].lng));for(var s=t+1;s<o.length;s++)o[t].dispositivo.nome===o[s].dispositivo.nome&&(i[t]=i[t]+1);var n=eUltimo(o,o[t].dispositivo.nome);void 0!==o[t].lng&&void 0!==o[t].lat?createMarker(e,i[t],n,o[t]):"SOS"==o[t].mensagem&&!1===o[t].visto?(somAlarme.play(),NotificacaoSOS(o[t].dispositivo.nome)):"AJUDA"!=o[t].mensagem&&"QUEDA"!=o[t].mensagem||!1!==o[t].visto||(NotificacaoAjuda(o[t].dispositivo.nome),somAlarme.play()),void 0!==o[t].lng&&void 0!==o[t].lat&&a.extend(e)}PolyMap(o),map.fitBounds(a)}function removerMarcadores(o){removeLines(),o.forEach(function(o){o.setMap(null)},this),o.length=0}function eUltimo(o,e){for(var a=0;a<o.length;a++)if(o[a].dispositivo.nome===e)return!1;return!0}function mostrarMarker(o,e,a,i){for(var t=0;t<i.length;t++)if(o==i[t].dispositivo.nome&&e==i[t].hora){if(void 0===i[t].lng||void 0===i[t].lat)return getInformacaoQualquer(o),somAlarme.currentTime>0&&somAlarme.pause(),toastr.info("Não foi possível pegar a Posição desse alarme!");var s=new google.maps.LatLng(i[t].lat,i[t].lng);map.setZoom(19),map.panTo(s);var n=new google.maps.Marker({icon:null,map:map,position:s});switch(a){case"SIGA-ME":n.icon={url:iconSigaMe};break;case"ESTOU-AQUI":n.icon={url:iconOk};break;case"PERSONALIZADA":n.icon={url:iconPersonalizada};break;case"SOS":n.icon={url:iconSOS};break;case"QUEDA":case"AJUDA":n.icon={url:iconAlarme}}n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null),n.setMap(null)},750),getInformacaoQualquer(o)}}function EstacaoRevisada(o){!0!==document.getElementById("checkbox1").checked||"LIFELINK"!=o&&"VLI"!=o&&"ATHENE"!=o&&"MEDICAR"!=o?Estacaorevisada.setMap(null):(Estacaorevisada=new google.maps.KmlLayer({url:"https://sites.google.com/site/kmlmapateste/testenovodestation/estacaoRevisada3.kml",preserveViewport:!0,map:null})).setMap(map)}function ExtensoEstacao(o){!0!==document.getElementById("checkbox2").checked||"LIFELINK"!=o&&"VLI"!=o&&"ATHENE"!=o&&"MEDICAR"!=o?EstacaoExtenso.setMap(null):(EstacaoExtenso=new google.maps.KmlLayer({url:"https://sites.google.com/site/kmlmapateste/estacaoextensonova/estacoesExtenso1.kml",preserveViewport:!0,map:null})).setMap(map)}function FerroTrecho(o){!0!==document.getElementById("checkbox3").checked||"LIFELINK"!=o&&"VLI"!=o&&"ATHENE"!=o&&"MEDICAR"!=o?trechoFerro.setMap(null):(trechoFerro=new google.maps.KmlLayer({url:"https://sites.google.com/site/kmlmapateste/trechopequenho/trechoFerroviario.kml",preserveViewport:!0})).setMap(map)}function AtlanticaLinha(o){!0!==document.getElementById("checkbox4").checked||"LIFELINK"!=o&&"VLI"!=o&&"ATHENE"!=o&&"MEDICAR"!=o?(ambiente15m1.setMap(null),ambiente15m2.setMap(null)):((ambiente15m1=new google.maps.KmlLayer({url:"https://sites.google.com/site/kmlmapateste/trechogrande1/meioAmbienteAtlantica.kml",preserveViewport:!0})).setMap(map),(ambiente15m2=new google.maps.KmlLayer({url:"https://sites.google.com/site/kmlmapateste/trechogrande2/atlanticapt2.kml",preserveViewport:!0})).setMap(map))}var map;$(document).ready(function(){CreateMap()});var flightPath,directionsDisplay,bounds,Estacaorevisada,EstacaoExtenso,trechoFerro,ambiente15m1,ambiente15m2,linha,iconSOS="images/SOS_B1.png",iconAlarme="images/Alarme_B1.png",iconSigaMe="images/sigaMe_B1.png",iconOk="images/Ok_B1.png",iconPersonalizada="images/Personalizada_B1.png",somAlarme=new Audio("audio/Alarme.mp3"),vetorDeMarkers=[],cores=["#000080","#FF1493","#FF4500","#006400","#000000 ","#660066 ","#993333","#003300 "];